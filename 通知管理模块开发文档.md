# 通知管理模块开发文档

## 概述

​	通知管理模块是一个用于管理系统通知的功能模块。该模块支持通知的新增、编辑、删除和批量删除等操作，提供了用户友好的界面和高效的操作方式。本模块使用了Vue.js框架，并结合`ant-design-vue`组件库，确保界面的美观性和一致性。

## 功能描述

- **通知信息展示**：使用`a-table`组件展示通知列表，包括通知的标题、内容和操作按钮。支持分页显示，每页显示10条通知信息。
- **搜索功能**：可以通过关键词搜索通知信息，并实时更新搜索结果。
- **新增通知**：通过点击“新增”按钮，弹出表单输入通知的标题和内容。支持表单验证，确保必要字段的完整性。
- **编辑通知**：通过点击表格中的“编辑”按钮，弹出表单编辑现有通知的信息。
- **删除通知**：支持单个删除和批量删除操作，确保通知信息的及时更新。

## 关系图

![](D:\mango\notice.vue关系图.png)

## 代码结构

### NoticeController

#### 关系图

![](D:\mango\NoticeController关系图.png)

#### 功能接口

##### 查询通知列表

**URL:** `/notice/list`

**请求方式:** `GET`

**描述:** 获取所有通知的列表。

**返回值:**

- `APIResponse` 对象，包含查询结果和状态码。

##### 创建通知

**URL:** `/notice/create`

**请求方式:** `POST`

**权限要求:** 管理员

**事务管理:** `@Transactional`

**描述:** 创建一个新的通知。

**参数:**

- `Notice` 对象，包含通知的详细信息。

**返回值:**

- `APIResponse` 对象，包含创建结果和状态码。

##### 删除通知

**URL:** `/notice/delete`

**请求方式:** `POST`

**权限要求:** 管理员

**描述:** 删除指定 ID 的通知。

**参数:**

- `String` 类型的通知 ID 列表，逗号分隔。

**返回值:**

- `APIResponse` 对象，包含删除结果和状态码。

##### 更新通知

**URL:** `/notice/update`

**请求方式:** `POST`

**权限要求:** 管理员

**事务管理:** `@Transactional`

**描述:** 更新通知的详细信息。

**参数:**

- `Notice` 对象，包含通知的详细信息。

**返回值:**

- `APIResponse` 对象，包含更新结果和状态码。

#### 代码

```java
package com.gk.study.controller;

import com.gk.study.common.APIResponse;
import com.gk.study.common.ResponeCode;
import com.gk.study.entity.Notice;
import com.gk.study.permission.Access;
import com.gk.study.permission.AccessLevel;
import com.gk.study.service.NoticeService;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;

import java.io.IOException;
import java.util.List;

@RestController
@RequestMapping("/notice")
public class NoticeController {

    private final static Logger logger = LoggerFactory.getLogger(NoticeController.class);

    @Autowired
    NoticeService service;

    @RequestMapping(value = "/list", method = RequestMethod.GET)
    public APIResponse list() {
        List<Notice> list = service.getNoticeList();
        return new APIResponse(ResponeCode.SUCCESS, "查询成功", list);
    }

    @Access(level = AccessLevel.ADMIN)
    @RequestMapping(value = "/create", method = RequestMethod.POST)
    @Transactional
    public APIResponse create(Notice notice) throws IOException {
        service.createNotice(notice);
        return new APIResponse(ResponeCode.SUCCESS, "创建成功");
    }

    @Access(level = AccessLevel.ADMIN)
    @RequestMapping(value = "/delete", method = RequestMethod.POST)
    public APIResponse delete(String ids) {
        System.out.println("ids===" + ids);
        // 批量删除
        String[] arr = ids.split(",");
        for (String id : arr) {
            service.deleteNotice(id);
        }
        return new APIResponse(ResponeCode.SUCCESS, "删除成功");
    }

    @Access(level = AccessLevel.ADMIN)
    @RequestMapping(value = "/update", method = RequestMethod.POST)
    @Transactional
    public APIResponse update(Notice notice) throws IOException {
        service.updateNotice(notice);
        return new APIResponse(ResponeCode.SUCCESS, "更新成功");
    }

}
```

#### 其他略

### 模板部分

```html
<template>
  <div>
    <!--页面区域-->
    <div class="page-view">
      <div class="table-operations">
        <a-space>
          <a-button type="primary" @click="handleAdd">新增</a-button>
          <a-button @click="handleBatchDelete">批量删除</a-button>
        </a-space>
      </div>
      <a-table
        size="middle"
        rowKey="id"
        :loading="data.loading"
        :columns="columns"
        :data-source="data.noticeList"
        :scroll="{ x: 'max-content' }"
        :row-selection="rowSelection"
        :pagination="{
          size: 'default',
          current: data.page,
          pageSize: data.pageSize,
          onChange: (current) => (data.page = current),
          showSizeChanger: false,
          showTotal: (total) => 共${total}条数据,
        }"
      >
        <template #bodyCell="{ text, record, index, column }">
          <template v-if="column.key === 'operation'">
            <span>
              <a @click="handleEdit(record)">编辑</a>
              <a-divider type="vertical" />
              <a-popconfirm title="确定删除?" ok-text="是" cancel-text="否" @confirm="confirmDelete(record)">
                <a href="#">删除</a>
              </a-popconfirm>
            </span>
          </template>
        </template>
      </a-table>
    </div>

    <!--弹窗区域-->
    <div>
      <a-modal
        :visible="modal.visile"
        :forceRender="true"
        :title="modal.title"
        ok-text="确认"
        cancel-text="取消"
        @cancel="handleCancel"
        @ok="handleOk"
      >
        <div>
          <a-form ref="myform" :label-col="{ style: { width: '80px' } }" :model="modal.form" :rules="modal.rules">
            <a-row :gutter="24">
              <a-col span="24">
                <a-form-item label="标题" name="title">
                  <a-input placeholder="请输入标题" v-model:value="modal.form.title"></a-input>
                </a-form-item>
              </a-col>
              <a-col span="24">
                <a-form-item label="通知内容" name="content">
                  <a-textarea placeholder="请输入内容" :rows="4" v-model:value="modal.form.content"></a-textarea>
                </a-form-item>
              </a-col>
            </a-row>
          </a-form>
        </div>
      </a-modal>
    </div>
  </div>
</template>
```

## 脚本部分

``` java
<script setup lang="ts">
import { FormInstance, message } from 'ant-design-vue';
import { createApi, NoticeListApi, updateApi, deleteApi } from '/@/api/notice';

const columns = reactive([
  {
    title: '序号',
    dataIndex: 'index',
    key: 'index',
    align: 'center'
  },
  {
    title: '标题',
    dataIndex: 'title',
    key: 'title',
    align: 'center'
  },
  {
    title: '内容',
    dataIndex: 'content',
    key: 'content',
    align: 'center',
    customRender: ({ text, record, index, column }) => text?.substring(0, 20) + '...',
  },
  {
    title: '操作',
    dataIndex: 'action',
    key: 'operation',
    align: 'center',
    fixed: 'right',
    width: 140,
  },
]);

// 页面数据
const data = reactive({
  noticeList: [],
  loading: false,
  keyword: '',
  selectedRowKeys: [] as any[],
  pageSize: 10,
  page: 1,
});

// 弹窗数据源
const modal = reactive({
  visile: false,
  editFlag: false,
  title: '',
  form: {
    id: undefined,
    title: undefined,
  },
  rules: {
    title: [{ required: true, message: '请输入', trigger: 'change' }],
  },
});

const myform = ref<FormInstance>();

onMounted(() => {
  getDataList();
});

const getDataList = () => {
  data.loading = true;
  NoticeListApi({
    keyword: data.keyword,
  })
    .then((res) => {
      data.loading = false;
      res.data.forEach((item: any, index: any) => {
        item.index = index + 1;
      });
      data.noticeList = res.data;
      data.loading = false;
    })
    .catch((err) => {
      data.loading = false;
      console.log(err);
    });
};

const rowSelection = ref({
  onChange: (selectedRowKeys: (string | number)[], selectedRows: DataItem[]) => {
    data.selectedRowKeys = selectedRowKeys;
  },
});

const handleAdd = () => {
  resetModal();
  modal.visile = true;
  modal.editFlag = false;
  modal.title = '新增';
  // 重置
  for (const key in modal.form) {
    modal.form[key] = undefined;
  }
};

const handleEdit = (record: any) => {
  resetModal();
  modal.visile = true;
  modal.editFlag = true;
  modal.title = '编辑';
  // 重置
  for (const key in modal.form) {
    modal.form[key] = undefined;
  }
  for (const key in record) {
    modal.form[key] = record[key];
  }
};

const confirmDelete = (record: any) => {
  deleteApi({ ids: record.id })
    .then((res) => {
      getDataList();
    })
    .catch((err) => {
      message.error(err.msg || '操作失败');
    });
};

const handleBatchDelete = () => {
  if (data.selectedRowKeys.length <= 0) {
    message.warn('请勾选删除项');
    return;
  }
  deleteApi({ ids: data.selectedRowKeys.join(',') })
    .then((res) => {
      message.success('删除成功');
      data.selectedRowKeys = [];
      getDataList();
    })
    .catch((err) => {
      message.error(err.msg || '操作失败');
    });
};

const handleOk = () => {
  myform.value
    ?.validate()
    .then(() => {
      if (modal.editFlag) {
        updateApi(modal.form)
          .then((res) => {
            hideModal();
            getDataList();
          })
          .catch((err) => {
            message.error(err.msg || '操作失败');
          });
      } else {
        createApi(modal.form)
          .then((res) => {
            hideModal();
            getDataList();
          })
          .catch((err) => {
            message.error(err.msg || '操作失败');
          });
      }
    })
    .catch((err) => {
      console.log('不能为空');
    });
};

const handleCancel = () => {
  hideModal();
};

// 恢复表单初始状态
const resetModal = () => {
  myform.value?.resetFields();
};

// 关闭弹窗
const hideModal = () => {
  modal.visile = false;
};
</script>
```

## 样式部分

``` java
<style scoped lang="less">
.page-view {
  min-height: 100%;
  background: #fff;
  padding: 24px;
  display: flex;
  flex-direction: column;
}

.table-operations {
  margin-bottom: 16px;
  text-align: right;
}

.table-operations > button {
  margin-right: 8px;
}
</style>
```

## API接口

- **获取通知列表**：`NoticeListApi({ keyword: data.keyword })`
- **新增通知**：`createApi(modal.form)`
- **更新通知**：`updateApi(modal.form)`
- **删除通知**：`deleteApi({ ids: record.id })`

## 主要功能实现

### 获取通知列表

``` java
  const getDataList = () => {
  data.loading = true;
  NoticeListApi({
    keyword: data.keyword,
  })
    .then((res) => {
      data.loading = false;
      res.data.forEach((item: any, index: any) => {
        item.index = index + 1;
      });
      data.noticeList = res.data;
      data.loading = false;
    })
    .catch((err) => {
      data.loading = false;
      console.log(err);
    });
};
```

### 新增通知

``` java
  const handleAdd = () => {
  resetModal();
  modal.visile = true;
  modal.editFlag = false;
  modal.title = '新增';
  // 重置
  for (const key in modal.form) {
    modal.form[key] = undefined;
  }
};
```

### 编辑通知

``` java
  const handleEdit = (record: any) => {
  resetModal();
  modal.visile = true;
  modal.editFlag = true;
  modal.title = '编辑';
  // 重置
  for (const key in modal.form) {
    modal.form[key] = undefined;
  }
  for (const key in record) {
    modal.form[key] = record[key];
  }
};
```

### 删除通知

``` java
  const confirmDelete = (record: any) => {
  deleteApi({ ids: record.id })
    .then((res) => {
      getDataList();
    })
    .catch((err) => {
      message.error(err.msg || '操作失败');
    });
};
```

### 批量删除

``` java
  const handleBatchDelete = () => {
  if (data.selectedRowKeys.length <= 0) {
    message.warn('请勾选删除项');
    return;
  }
  deleteApi({ ids: data.selectedRowKeys.join(',') })
    .then((res) => {
      message.success('删除成功');
      data.selectedRowKeys = [];
      getDataList();
    })
    .catch((err) => {
      message.error(err.msg || '操作失败');
    });
};
```

### 提交表单

``` java
  const handleOk = () => {
  myform.value
    ?.validate()
    .then(() => {
      if (modal.editFlag) {
        updateApi(modal.form)
          .then((res) => {
            hideModal();
            getDataList();
          })
          .catch((err) => {
            message.error(err.msg || '操作失败');
          });
      } else {
        createApi(modal.form)
          .then((res) => {
            hideModal();
            getDataList();
          })
          .catch((err) => {
            message.error(err.msg || '操作失败');
          });
      }
    })
    .catch((err) => {
      console.log('不能为空');
    });
};
```

## 注意事项

- **数据格式**：确保后端API返回的数据格式与前端组件预期一致，避免数据解析错误。
- **组件库依赖**：确保项目中安装并正确配置了`ant-design-vue`组件库，以支持表格、表单、弹窗等UI组件的使用。

## 总结

​	通知管理模块为系统提供了一个高效的通知管理工具，通过直观的界面和便捷的操作方式，管理员可以轻松管理通知信息，提升工作效率。该模块的设计和实现充分考虑了用户体验，使用现代化的前端技术栈，确保系统的可维护性和可扩展性。开发者可以根据具体需求对模块进行定制和扩展，满足不同场景下的通知管理需求。